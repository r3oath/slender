(function(){var r,s,l,q,f,t,e,u,v={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)v.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a};window.App={Models:{},Views:{},Collections:{},Router:{},RouteFuncs:{},Actions:{}};window.vent=_.extend({},Backbone.Events);window.template=function(a){return _.template($("#"+a).html())};e=$("#tag-area");t=$("#status-bar");u=$("#updated-tag-notice");var c=App.Models,m=function(){return m.__super__.constructor.apply(this,
arguments)};g(m,Backbone.Model);m.prototype.urlRoot="tags";m.prototype.defaults={contents:"",alt:"",description:"",type:"",error:""};c.Tag=m;var c=App.Views,h=function(){return h.__super__.constructor.apply(this,arguments)};g(h,Backbone.View);h.prototype.events={click:"tagClicked","click .delete-tag":"deleteMe"};h.prototype.tagClicked=function(){return window.vent.trigger("gotoEditTag",this.model.get("id"))};h.prototype.deleteMe=function(a){a.stopImmediatePropagation();if(!0===confirm("This will delete the tag and/or reset the associated content."))return this.$el.fadeOut(),
this.model.destroy()};h.prototype.template=template("tagTemplate");h.prototype.render=function(){this.$el.html(this.template(this.model.toJSON()));return this};c.Tag=h;var c=App.Views,i=function(){return i.__super__.constructor.apply(this,arguments)};g(i,Backbone.View);i.prototype.events={click:"tagClicked","click .delete-tag":"deleteMe"};i.prototype.tagClicked=function(){return window.vent.trigger("gotoEditTag",this.model.get("id"))};i.prototype.deleteMe=function(a){a.stopImmediatePropagation();
return alert("Deleted tag")};i.prototype.template=template("tagTemplateNew");i.prototype.render=function(){this.$el.html(this.template(this.model.toJSON()));return this};c.NewTag=i;var c=App.Views,n=function(){return n.__super__.constructor.apply(this,arguments)};g(n,Backbone.View);n.prototype.render=function(){this.collection.each(this.addOne,this);return this};n.prototype.addOne=function(a){a=1===a.get("enabled")?new App.Views.Tag({model:a}):new App.Views.NewTag({model:a});return this.$el.append(a.render().el)};
c.Tags=n;var c=App.Views,j=function(){return j.__super__.constructor.apply(this,arguments)};g(j,Backbone.View);j.prototype.events={"click #save-tag":"saveTag"};j.prototype.saveTag=function(){$("#save-tag").attr("disabled","disabled");this.model.set("contents",$("#markitup").val());this.model.set("enabled",1);this.model.save();return window.vent.trigger("gotoUpdatedTags")};j.prototype.template=template("editTagTemplate");j.prototype.render=function(){this.$el.html(this.template(this.model.toJSON()));
return this};c.EditTag=j;var c=App.Views,k=function(){return k.__super__.constructor.apply(this,arguments)};g(k,Backbone.View);k.prototype.events={"click #save-tag":"saveTag"};k.prototype.saveTag=function(){$("#save-tag").attr("disabled","disabled");this.model.set("contents",$("#image-contents").val());this.model.set("alt",$("#image-alt").val());this.model.set("enabled",1);this.model.save();return window.vent.trigger("gotoUpdatedTags")};k.prototype.template=template("editImageTagTemplate");k.prototype.render=
function(){this.$el.html(this.template(this.model.toJSON()));return this};c.EditImageTag=k;var c=App.Collections,p=function(){return p.__super__.constructor.apply(this,arguments)};g(p,Backbone.Collection);p.prototype.model=App.Models.Tag;p.prototype.url="tags";c.Tags=p;var c=App,d=function(){return d.__super__.constructor.apply(this,arguments)};g(d,Backbone.Router);d.prototype.initialize=function(){window.vent.on("gotoEditTag",this.gotoEditTag,this);window.vent.on("gotoUpdatedTags",this.gotoUpdatedTags,
this);window.vent.on("gotoShowTags",this.gotoShowTags,this);return window.vent.on("gotoFilterTags",this.gotoFilterTags,this)};d.prototype.routes={"":"showTags","edit/:id":"editTag","filter/:id":"filterTags"};d.prototype.gotoUpdatedTags=function(){this.navigate("");return this.updatedTags()};d.prototype.updatedTags=function(){l("Displaying all Tags");return f(q(1))};d.prototype.gotoShowTags=function(){return this.navigate("",{trigger:!0})};d.prototype.showTags=function(){l("Displaying all Tags");return f(q())};
d.prototype.gotoEditTag=function(a){return this.navigate("edit/"+a,{trigger:!0})};d.prototype.editTag=function(a){l("Editing Tag ID: "+a);return f(r(a))};d.prototype.gotoFilterTags=function(a){return this.navigate("filter/"+a,{trigger:!0})};d.prototype.filterTags=function(a){l("Displaying all "+a+" Tags");return f(s(a))};c.Router=d;f=function(a){null==a&&(a=function(){});return e.stop(!0,!0).animate({height:"toggle",opacity:"toggle"},a)};l=function(a){return t.html(a)};q=function(a){var b;null==a&&
(a=0);b=new App.Collections.Tags;return b.fetch({success:function(){var c;if(0===b.length)return e.html('<div class="error">There are currently no tags available. Start tagging!<div>'),f();c=new App.Views.Tags({collection:b});e.html(c.render().el);f();if(1===a)return u.fadeIn().delay(2E3).fadeOut()}})};r=function(a){var b;b=new App.Models.Tag;b.set("id",a);return b.fetch({success:function(){var a;""!==b.get("error")?e.html('<div class="error">'+b.get("error")+"<div>"):"image"!==b.get("type")?(a=new App.Views.EditTag({model:b}),
e.html(a.render().el),"html"===b.get("type")&&$("#markitup").markItUp(mySettings)):(a=new App.Views.EditImageTag({model:b}),e.html(a.render().el));return f()}})};s=function(a){var b;b=new App.Collections.Tags;return b.fetch({success:function(){var c;0===b.length?e.html('<div class="error">There are currently no tags available. Start tagging!<div>'):(b.reset(b.where({type:a})),0!==b.length?(c=new App.Views.Tags({collection:b}),e.html(c.render().el)):e.html('<div class="error">There are currently no '+
a+" tags.<div>"));return f()}})};new App.Router;Backbone.history.start()}).call(this);
